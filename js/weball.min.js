
var hand, win;
var ballId = 2;
var playground = $("#playground");
var homeRight = $("#homeRight");
var homeLeft = $("#homeLeft");
var shooterRight = $("#shooterRight");
var shooterLeft = $("#shooterLeft");
var shooters = $(".shooter");
var lineRight = $("#lineRight");
var lineLeft = $("#lineLeft");
var info = $("#info");
var red = [[1],[],[],[],[],[],[],[],[],[],[],[],[],[]];
var blue = [[2],[],[],[],[],[],[],[],[],[],[],[],[],[]];


var ballRed = [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
var ballBlue = [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0];

/**
*   Round number to x35 - Ball Size
*/
function roundBall (x) {
    return (x % 35) >= 17.5 ? parseInt(x / 35) * 35 + 35 : parseInt(x / 35) * 35;
}

/**
*   Check if Player Win the Game.
*/
function wonGame (side) {
  hand = false;
  shooters.fadeOut('slow');
  info.html(side + ' Won this hand ..!');
  // Log Move
  console.log(side +' is Winner !');
}

/**
*   Turn Hand to Other Player.
*/
function turnHand (turn) {
  hand = turn;
  shooter = (hand == 'Left') ? homeRight : homeLeft;
  homeLeft.animate({opacity: 1}, 1);
  homeRight.animate({opacity: 1}, 1);
  shooter.animate({opacity: 0.3}, 5);
  ballId++;
  // Log Turn
  console.log('Ball ' +ballId + ' Shooted, Now '+ turn + ' Turn ');
};
turnHand ('Right'); // Start the Game

/**
*   Move the Shooter
*/
$(".home").click(function() {
  let shooter = $('#' + $(this).attr("id") + ">.shooter"); // Get side
  shooter.animate({opacity: 0.4}, 10); // Effect Start
  let playgroundMax = playground.height()-78; // get Max
  let shooterY = event.pageY-(playground.offset().top); // get clicked point
  shooterY = (shooterY > playgroundMax) ? (playgroundMax) : shooterY; // Check Max < PgMax
  shooterY = (shooterY < 0) ? (shooterY + 38) : shooterY; // Check Min > 0
  shooter.animate({top: shooterY}, 130).animate({opacity: 1}, 8); // Move && End Effect
  // Log Move
  console.log(shooter.data('side')+' Shooter moved to: '+shooterY);
});

/**
*  Shoot Ball
*/
$(".shooter").click(function() {
  let destroy = false;
  let shooterId = '#'+$(this).attr("id");
  // Set Shooter Properties
  if (hand == 'Right') {
    ballColor = 'red';
    nextHand = 'Left';
    handShooter = '#shooterRight';
    line = lineLeft;
  } else if (hand == 'Left') {
    ballColor = 'blue';
    nextHand = 'Right';
    handShooter = '#shooterLeft';
    line = lineRight;
  }
  if (shooterId == handShooter) {   // Check if True Player Shoot
    var shooterBall = $(shooterId+' .circle').offset();

    // Creat New Ball
    var newball = '<figure id="ball-'+ballId+'" class="circle '+ballColor+'">'+ballId+'</figure>';
    line.append(newball);
    var ball = $("#ball-"+ballId);
    ball.offset(shooterBall);

    // Set Ball Row
    var playgroundTOP = playground.offset().top;
    var placeY = roundBall(shooterBall.top)-playgroundTOP;
    var ballRow = (roundBall(shooterBall.top-playgroundTOP)/35);

    // Set Ball X
    var optionsX = {};
    if (hand == 'Left') {
      optionsX['left'] = (blue[ballRow].length*35)+5;
      blue[ballRow].unshift(ballId); // Add Ball To obj
      var win = (blue[ballRow].length > 9) ? 'Left' : false;
    } else {
      optionsX['left'] = -(red[ballRow].length*35)-35;
      red[ballRow].unshift(ballId); // Add Ball To obj
      var win = (red[ballRow].length > 9) ? 'Right' : false;
    }
    // Destroy Rival Ball
    if (!win && (red[ballRow].length+blue[ballRow].length)>8) {
        setTimeout(function(){
          ball.removeClass('red').addClass('destroy')
          .animate({opacity: 0.10}, 50);
      }, 500);

      // Grab rival Ball
      var targetX = {};
      if (hand == 'Right') {
        var targetID = blue[ballRow][0];
        red[ballRow].shift();
        blue[ballRow].shift();
        targetX['left'] = (blue[ballRow-1].length*35)+5;
        blue[ballRow-1].unshift(targetID);
      } else {
        var targetID = red[ballRow][0];
        blue[ballRow].shift();
        red[ballRow].shift();
        targetX['left'] = -(red[ballRow-1].length*35)-35;
        red[ballRow-1].unshift(targetID);
      }
      var targetBall = $('#ball-'+targetID);
      targetBall.animate(targetX, 300).animate({top:'-=35px'}, 150);
    }
    ball.animate(optionsX, 550);
    ball.animate({top:placeY}, 150); // Fit to row
    ball.animate({opacity: 1}, 30);
    (win) ? wonGame(win) : turnHand (nextHand);
  } else {
    console.log(handShooter+' != ' + shooterId);
  }
  //
});
